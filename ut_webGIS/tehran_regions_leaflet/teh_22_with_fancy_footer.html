<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>نقشه مناطق تهران</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Vazirmatn', Tahoma, sans-serif;
      background: radial-gradient(circle at center, #0d47a1, #000000);
      color: white;
    }

    header {
      background: linear-gradient(90deg, #0d47a1, #1e88e5);
      color: white;
      padding: 1.5rem 2rem;
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.5);
      letter-spacing: 1px;
    }

    #map {
      height: 85vh;
      width: 100%;
      z-index: 0;
    }

    .floating-tooltip {
      position: absolute;
      padding: 0;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      pointer-events: none;
      opacity: 0;
      transform: translate(-50%, -120%);
      transition: all 0.4s ease;
      z-index: 1001;
      width: 280px;
      overflow: hidden;
      color: #000;
    }

    .floating-tooltip.active {
      opacity: 1;
      transform: translate(-50%, -90%);
    }

    .tooltip-header {
      background: linear-gradient(135deg, #1e88e5 0%, #0d47a1 100%);
      color: white;
      padding: 15px;
    }

    .tooltip-header h3 {
      margin: 0;
      font-size: 18px;
      display: flex;
      justify-content: space-between;
    }

    .tooltip-badge {
      background: rgba(255, 255, 255, 0.2);
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 12px;
    }

    .tooltip-body {
      padding: 15px;
      background: #f5f5f5;
    }

    .info-row {
      display: flex;
      margin-bottom: 10px;
      align-items: center;
    }

    .info-label {
      font-weight: bold;
      color: #555;
      width: 80px;
      font-size: 13px;
    }

    .info-value {
      flex: 1;
      color: #333;
      font-size: 14px;
    }

    footer {
      position: relative;
      overflow: hidden;
      background-color: black;
      color: white;
      padding: 3rem 1rem;
      text-align: center;
    }

    footer h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    footer p {
      font-size: 0.95rem;
      opacity: 0.8;
    }

    footer canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    footer .footer-content {
      position: relative;
      z-index: 1;
    }
  </style>
</head>
<body>

<header>
  نقشه تعاملی مناطق تهران
</header>

<div id="map"></div>

<div id="tooltip" class="floating-tooltip">
  <div class="tooltip-header">
    <h3><span id="region-name">منطقه</span> <span class="tooltip-badge" id="region-id">#0</span></h3>
  </div>
  <div class="tooltip-body">
    <div class="info-row">
      <span class="info-label">مساحت:</span>
      <span class="info-value" id="region-area">---</span>
    </div>
    <div class="info-row">
      <span class="info-label">محیط:</span>
      <span class="info-value" id="region-length">---</span>
    </div>
  </div>
</div>

<footer>
  <canvas id="vortex-canvas"></canvas>
  <div class="footer-content">
    <h2>تهران اینتراکتیو</h2>
    <p>© 2025 طراحی شده توسط Mahyar | برای دیدن جزییات فایل را با یک سررور محلی اجرا کنید</p>
    <p>python -m http.server 8000</p>
  </div>
</footer>

<script>
  const map = L.map('map').setView([35.6892, 51.3890], 12);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const tooltip = document.getElementById('tooltip');
  let currentHighlightedLayer = null;

  fetch('region_22.geojson')
    .then(response => response.json())
    .then(data => {
      const geojsonLayer = L.geoJSON(data, {
        style: {
          color: '#1565c0',
          weight: 2,
          fillColor: '#64b5f6',
          fillOpacity: 0.5
        },
        onEachFeature: function (feature, layer) {
          layer.on({
            mouseover: function (e) {
              if (currentHighlightedLayer) {
                currentHighlightedLayer.setStyle({
                  fillColor: '#64b5f6',
                  fillOpacity: 0.5
                });
              }
              e.target.setStyle({
                fillColor: '#ffca28',
                fillOpacity: 0.7
              });
              currentHighlightedLayer = e.target;
              updateTooltip(feature, e.latlng);
              tooltip.classList.add('active');
            },
            mouseout: function () {
              tooltip.classList.remove('active');
            },
            mousemove: function (e) {
              updateTooltipPosition(e.latlng);
            },
            click: function (e) {
              map.fitBounds(e.target.getBounds());
            }
          });
        }
      }).addTo(map);

      map.fitBounds(geojsonLayer.getBounds());
    })
    .catch(error => {
      console.error('GeoJSON error:', error);
      alert('خطا در بارگذاری فایل GeoJSON!');
    });

  function updateTooltip(feature, latlng) {
    document.getElementById('region-name').textContent = `منطقه ${feature.properties.reg_no || 'ناشناخته'}`;
    document.getElementById('region-id').textContent = `#${feature.properties.OBJECTID || '0'}`;
    document.getElementById('region-area').textContent = feature.properties.Shape_Area
      ? Math.round(feature.properties.Shape_Area).toLocaleString() + ' متر مربع'
      : '---';
    document.getElementById('region-length').textContent = feature.properties.Shape_Leng
      ? Math.round(feature.properties.Shape_Leng).toLocaleString() + ' متر'
      : '---';
    updateTooltipPosition(latlng);
  }

  function updateTooltipPosition(latlng) {
    const point = map.latLngToContainerPoint(latlng);
    tooltip.style.left = point.x + 'px';
    tooltip.style.top = point.y + 'px';
  }

  // vortex animation
  const canvas = document.getElementById('vortex-canvas');
  const ctx = canvas.getContext('2d');
  let particles = [];

  function resizeCanvas() {
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  for (let i = 0; i < 150; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 2 + 1,
      dx: Math.random() * 0.5 - 0.25,
      dy: Math.random() * 0.5 - 0.25,
      hue: Math.floor(Math.random() * 360)
    });
  }

  function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = `hsl(${p.hue}, 100%, 70%)`;
      ctx.fill();
      p.x += p.dx;
      p.y += p.dy;
      if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
      if (p.y < 0 || p.y > canvas.height) p.dy *= -1;
    });
    requestAnimationFrame(animateParticles);
  }

  animateParticles();
</script>

</body>
</html>
