<!DOCTYPE html>
<html>
<head>
  <title>Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§ Ú†Ù†Ø¯ Ø¨ÛŒØ³â€ŒÙ…Ù¾</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    #map { height: 500px; width: 100%; }
    body { font-family: Tahoma; margin: 0; padding: 10px; }
    .controls {
      background: #f8f9fa;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      max-width: 300px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    button {
      background: #3498db;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover { background: #2980b9; }
    .instructions {
      font-size: 14px;
      color: #666;
      margin-top: 10px;
    }
    .leaflet-control-layers-selector {
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <div class="controls">
    <h2 style="margin-top: 0;">Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</h2>
    <input type="text" id="startInput" placeholder="Ù…Ø¨Ø¯Ø£ (Ù…Ø«Ø§Ù„: ØªÙ‡Ø±Ø§Ù†ØŒ Ù…ÛŒØ¯Ø§Ù† Ø¢Ø²Ø§Ø¯ÛŒ)">
    <input type="text" id="endInput" placeholder="Ù…Ù‚ØµØ¯ (Ù…Ø«Ø§Ù„: Ø±Ø´ØªØŒ Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø±Ø¯Ø§Ø±ÛŒ)">
    <button onclick="findRouteByText()">Ù†Ù…Ø§ÛŒØ´ Ù…Ø³ÛŒØ±</button>
    <div class="instructions">
      ÛŒØ§ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯:<br>
      Ú©Ù„ÛŒÚ© Ø§ÙˆÙ„: Ù…Ø¨Ø¯Ø£ | Ú©Ù„ÛŒÚ© Ø¯ÙˆÙ…: Ù…Ù‚ØµØ¯
    </div>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
    const map = L.map('map').setView([35.6892, 51.3890], 6);
    
    // ØªØ¹Ø±ÛŒÙ Ø¨ÛŒØ³â€ŒÙ…Ù¾â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      maxZoom: 19
    });
    
    const esriStreets = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ',
      maxZoom: 19
    });
    
    const esriTopo = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles &copy; Esri',
      maxZoom: 19
    });
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨ÛŒØ³â€ŒÙ…Ù¾ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    osm.addTo(map);
    
    // ØªØ¹Ø±ÛŒÙ Ú©Ù†ØªØ±Ù„ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§
    const baseLayers = {
      "OpenStreetMap": osm,
      "ESRI Streets": esriStreets,
      "ESRI Topographic": esriTopo
    };
    L.control.layers(baseLayers).addTo(map);
	
	
    
    const apiKey = 'eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6IjM0MDNjM2ZlYjg5NDQ1MzViNTk2ZmM5ZDRlM2Y3YTIyIiwiaCI6Im11cm11cjY0In0=';
    let startPoint = null;
    let endPoint = null;
    let routeLayer = null;
    const markers = [];
    
    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù…Ø³ÛŒØ± Ùˆ Ù…Ø§Ø±Ú©Ø±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
    function clearMap() {
      if (routeLayer) map.removeLayer(routeLayer);
      markers.forEach(marker => map.removeLayer(marker));
      markers.length = 0;
    }
    
    // Ø¬Ø¦ÙˆÚ©Ø¯ÛŒÙ†Ú¯ (ØªØ¨Ø¯ÛŒÙ„ Ø¢Ø¯Ø±Ø³ Ø¨Ù‡ Ù…Ø®ØªØµØ§Øª)
    function geocode(address, callback) {
      fetch(`https://api.openrouteservice.org/geocode/search?api_key=${apiKey}&text=${encodeURIComponent(address)}`)
        .then(r => r.json())
        .then(data => {
          if (data.features && data.features.length > 0) {
            const firstResult = data.features[0];
            callback({
              lat: firstResult.geometry.coordinates[1],
              lng: firstResult.geometry.coordinates[0],
              name: firstResult.properties.label
            });
          } else {
            alert("Ø¢Ø¯Ø±Ø³ ÛŒØ§ÙØª Ù†Ø´Ø¯!");
          }
        })
        .catch(error => {
          console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø¦ÙˆÚ©Ø¯ÛŒÙ†Ú¯:", error);
          alert("Ø®Ø·Ø§ Ø¯Ø± ÛŒØ§ÙØªÙ† Ø¢Ø¯Ø±Ø³");
        });
    }
    
    // Ù†Ù…Ø§ÛŒØ´ Ù…Ø³ÛŒØ±
    function showRoute(start, end) {
      clearMap();
      
      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø§Ø±Ú©Ø±Ù‡Ø§
      markers.push(L.marker([start.lat, start.lng]).addTo(map).bindPopup(`<b>Ù…Ø¨Ø¯Ø£:</b> ${start.name}`).openPopup());
      markers.push(L.marker([end.lat, end.lng]).addTo(map).bindPopup(`<b>Ù…Ù‚ØµØ¯:</b> ${end.name}`));
      
      // Ø¯Ø±ÛŒØ§ÙØª Ù…Ø³ÛŒØ± Ø§Ø² API
      fetch(`https://api.openrouteservice.org/v2/directions/driving-car?api_key=${apiKey}&start=${start.lng},${start.lat}&end=${end.lng},${end.lat}`)
        .then(r => r.json())
        .then(data => {
          if (data.features?.[0]?.geometry) {
            const duration = Math.round(data.features[0].properties.segments[0].duration / 60);
            const distance = (data.features[0].properties.segments[0].distance / 1000).toFixed(1);
            
            routeLayer = L.geoJSON(data.features[0].geometry, {
              style: { color: '#e74c3c', weight: 5 }
            }).addTo(map).bindPopup(`
              <div style="font-size: 14px;">
                <div><b>â± Ø²Ù…Ø§Ù† Ø³ÙØ±:</b> ${duration} Ø¯Ù‚ÛŒÙ‚Ù‡</div>
                <div><b>ğŸ“ Ù…Ø³Ø§ÙØª:</b> ${distance} Ú©ÛŒÙ„ÙˆÙ…ØªØ±</div>
              </div>
            `).openPopup();
            
            map.fitBounds(routeLayer.getBounds());
          }
        });
    }
    
    // Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ø¨Ø§ Ú©Ù„ÛŒÚ©
    map.on('click', e => {
      if (!startPoint) {
        startPoint = { lat: e.latlng.lat, lng: e.latlng.lng, name: "Ù†Ù‚Ø·Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡" };
        document.getElementById('startInput').value = startPoint.name;
      } else {
        endPoint = { lat: e.latlng.lat, lng: e.latlng.lng, name: "Ù†Ù‚Ø·Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡" };
        document.getElementById('endInput').value = endPoint.name;
        showRoute(startPoint, endPoint);
        startPoint = null;
        endPoint = null;
      }
    });
    
    // Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ø¨Ø§ Ù…ØªÙ†
    function findRouteByText() {
      const startText = document.getElementById('startInput').value.trim();
      const endText = document.getElementById('endInput').value.trim();
      
      if (!startText || !endText) {
        alert("Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ø¯Ø£ Ùˆ Ù…Ù‚ØµØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
        return;
      }
      
      // Ø¬Ø¦ÙˆÚ©Ø¯ÛŒÙ†Ú¯ Ù…Ø¨Ø¯Ø£
      geocode(startText, function(start) {
        // Ø¬Ø¦ÙˆÚ©Ø¯ÛŒÙ†Ú¯ Ù…Ù‚ØµØ¯
        geocode(endText, function(end) {
          showRoute(start, end);
        });
      });
    }
  </script>
</body>
</html>